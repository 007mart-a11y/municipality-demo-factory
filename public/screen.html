<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ukázka AI asistenta obce</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, Arial, sans-serif;
      background: #000;
    }

    body {
      background-size: cover;
      background-position: top center;
      background-repeat: no-repeat;
    }

    /* jemné ztmavení pozadí */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      pointer-events: none;
    }

    iframe {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 380px;
      height: 560px;
      border: none;
      border-radius: 18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      background: transparent;
      z-index: 10;
    }

    @media (max-width: 480px) {
      iframe {
        width: calc(100% - 20px);
        height: 80vh;
        right: 10px;
        bottom: 10px;
      }
    }
  </style>
</head>

<body>

  <!-- Chat -->
  <iframe id="chat" loading="lazy"></iframe>

  <script>
    const params = new URLSearchParams(window.location.search);

    function normalizeSlug(v) {
      return String(v || "")
        .toLowerCase()
        .trim()
        .replace(/\s+/g, "-")
        .replace(/[^a-z0-9\-]/g, "")
        .replace(/-+/g, "-")
        .replace(/^-|-$/g, "");
    }

    const requested = normalizeSlug(params.get("obec")) || "radim";
    const FALLBACK_SLUG = "radim";

    const FALLBACK_BG = `/skins/${FALLBACK_SLUG}/bg.jpg`;
    const bgUrl = `/skins/${requested}/bg.jpg`;

    const chatEl = document.getElementById("chat");

    function setBg(url) {
      document.body.style.backgroundImage = `url("${url}")`;
    }

    function setChat(slug) {
      chatEl.src = `/?obec=${encodeURIComponent(slug)}`;
    }

    // default: zkusíme chtěnou obec
    setChat(requested);

    // cache-bust, ať se vždy natáhne aktuální soubor
    const bust = `?v=${Date.now()}`;

    const img = new Image();
    img.onload = () => {
      setBg(bgUrl + bust);
    };
    img.onerror = () => {
      // když bg pro obec neexistuje -> přepneme i chat na fallback,
      // aby se "neexistující obec" dál netvářila jako ok
      setBg(FALLBACK_BG + bust);
      setChat(FALLBACK_SLUG);
    };
    img.src = bgUrl + bust;
  </script>

</body>
</html>
